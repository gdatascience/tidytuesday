prep()
penguin_recipe
tidy(penguin_recipe)
tidy(penguin_recipe, id = "pca") # this is equivalent to
tidy(penguin_recipe, 3)
penguin_recipe %>%
tidy(id = "pca") %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap(~component, nrow = 1) +
labs(y = NULL)
theme_set(theme_minimal())
penguin_recipe %>%
tidy(id = "pca") %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap(~component, nrow = 1) +
labs(y = NULL)
penguin_pca <-
penguin_recipe %>%
tidy(id = "pca")
# get pca loadings into wider format
pca_wider <- penguin_pca %>%
pivot_wider(names_from = component, id_cols = terms)
pca_wider
# We also need to go back to our prepped penguin recipe, prepped_penguins,
# and recipes::juice() it to get the PCA scores back.
penguin_recipe
juice(penguin_recipe)
pca_plot <-
juice(penguin_recipe) %>%
ggplot(aes(PC1, PC2)) +
geom_point(aes(color = species, shape = species),
alpha = 0.8,
size = 2) +
scale_colour_manual(values = c("darkorange","purple","cyan4"))
pca_plot
# define arrow style
arrow_style <- arrow(length = unit(.05, "inches"),
type = "closed")
pca_plot +
geom_segment(data = pca_wider,
aes(xend = PC1, yend = PC2),
x = 0,
y = 0,
arrow = arrow_style) +
geom_text(data = pca_wider,
aes(x = PC1, y = PC2, label = terms),
hjust = 0,
vjust = 1,
size = 5,
color = '#0A537D') # confirms that penguins with longer flippers, higher body mass, and longer bill length,
# have shorter bill depth
# This scatter plot confirms this
penguins %>%
ggplot(aes(x = body_mass_g, y = bill_depth_mm, colour = species)) +
geom_point() +
scale_colour_manual(values = c("darkorange","purple", "cyan4"))
?tidytuesdayR::use_tidytemplate()
tidytuesdayR::use_tidytemplate(name = "women.rmd")
tidytuesdayR::use_tidytemplate()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidytuesdayR)
tt <- tt_load("2020-12-08")
tt <- tt_load("2020-12-08")
tt %>%
map(glimpse)
women_raw <- tt$women
women <- women_raw
women %>%
count(category, sort = TRUE) %>%
mutate(category = fct_reorder(category, n)) %>%
ggplot(aes(n, category, fill = category)) +
geom_col(show.legend = FALSE)
women %>%
mutate(role = fct_lump(role,10)) %>%
filter(role != "Other") %>%
count(role, sort = TRUE) %>%
mutate(role = fct_reorder(role, n)) %>%
ggplot(aes(n, role, fill = role)) +
geom_col(show.legend = FALSE)
library(gt)
t <- women %>%
select(img, name, country, category, role, description) %>%
#group_by(category) %>%
gt(rowname_col = "name") %>%
text_transform(
locations = cells_body(
vars(img)
),
fn = function(x) {
web_image(
url = x,
height = 50
)
}
) %>%
cols_width(
vars(img) ~ px(50),
vars(country) ~ px(100),
vars(category) ~ px(100),
vars(role) ~ px(100),
vars(description) ~ px(300),
everything() ~ px(125)
) %>%
cols_label(
img = "",
country = "COUNTRY",
category = "CATEGORY",
role = "ROLE",
description = "DESCRIPTION"
) %>%
tab_style(
style = list(
cell_text(weight = "bold")
),
locations = cells_column_labels(everything())
) %>%
tab_options(
table.font.size = 12
) %>%
tab_header(title = md("**WOMEN OF 2020**")) %>%
tab_source_note(source_note = md("**Source**: BBC  |  **Designed By**: Tony Galvan (@GDataScience1)<br>**Inspiration**: @thomas_mock"))
t
women %>%
count(category, sort = TRUE) %>%
mutate(category = fct_reorder(category, n)) %>%
ggplot(aes(n, category, fill = category)) +
geom_col(show.legend = FALSE)
women %>%
mutate(role = fct_lump(role,10)) %>%
filter(role != "Other") %>%
count(role, sort = TRUE) %>%
mutate(role = fct_reorder(role, n)) %>%
ggplot(aes(n, role, fill = role)) +
geom_col(show.legend = FALSE)
library(gt)
t <- women %>%
select(img, name, country, category, role, description) %>%
#group_by(category) %>%
gt(rowname_col = "name") %>%
text_transform(
locations = cells_body(
vars(img)
),
fn = function(x) {
web_image(
url = x,
height = 50
)
}
) %>%
cols_width(
vars(img) ~ px(50),
vars(country) ~ px(100),
vars(category) ~ px(100),
vars(role) ~ px(100),
vars(description) ~ px(300),
everything() ~ px(125)
) %>%
cols_label(
img = "",
country = "COUNTRY",
category = "CATEGORY",
role = "ROLE",
description = "DESCRIPTION"
) %>%
tab_style(
style = list(
cell_text(weight = "bold")
),
locations = cells_column_labels(everything())
) %>%
tab_options(
table.font.size = 12
) %>%
tab_header(title = md("**WOMEN OF 2020**")) %>%
tab_source_note(source_note = md("**Source**: BBC  |  **Designed By**: Tony Galvan (@GDataScience1)<br>**Inspiration**: @thomas_mock"))
t
library(gt)
women %>%
gt()
t <- women %>%
select(img, name, country, category, role, description) %>%
#group_by(category) %>%
gt(rowname_col = "name") %>%
text_transform(
locations = cells_body(
vars(img)
),
fn = function(x) {
web_image(
url = x,
height = 50
)
}
) %>%
cols_width(
vars(img) ~ px(50),
vars(country) ~ px(100),
vars(category) ~ px(100),
vars(role) ~ px(100),
vars(description) ~ px(300),
everything() ~ px(125)
) %>%
cols_label(
img = "",
country = "COUNTRY",
category = "CATEGORY",
role = "ROLE",
description = "DESCRIPTION"
) %>%
tab_style(
style = list(
cell_text(weight = "bold")
),
locations = cells_column_labels(everything())
) %>%
tab_options(
table.font.size = 12
) %>%
tab_header(title = md("**WOMEN OF 2020**")) %>%
tab_source_note(source_note = md("**Source**: BBC  |  **Designed By**: Tony Galvan (@GDataScience1)<br>**Inspiration**: @thomas_mock"))
t
women %>%
gt()
women %>%
mutate(role = fct_lump(role,10)) %>%
filter(role != "Other") %>%
count(role, sort = TRUE) %>%
mutate(role = fct_reorder(role, n)) %>%
ggplot(aes(n, role, fill = role)) +
geom_col(show.legend = FALSE)
library(tidyverse)
library(tidytuesdayR)
library(plotly) # for interactive sunburst chart
library(htmlwidgets) # to save widget
tt <- tt_load("2020-12-08")
women <- tt$women
women <- tt$women
# prep dataframe1
labels <- c("All", "Creativity", "Identity", "Knowledge", "Leadership")
values <- c(1, 21, 17, 32, 29)
parents <- c("", "", "", "", "")
ids <- c("All", "Creativity", "Identity", "Knowledge", "Leadership")
img <- c("", "", "", "", "")
country <- c("various", "various", "various", "various", "various")
role <- c("various", "various", "various", "various", "various")
description <- c("n = 1", "n = 21", "n = 17", "n = 32", "n = 29")
colors <- c("#e8f72f", "#9d02d7", "#34dd26", "#0000ff", "#ffb14e")
df1 <- data.frame(labels, values, parents, ids, img, country, role, description, colors)
# prep dataframe2
df2 <- women %>%
rename(labels = name,
parents = category) %>%
mutate(values = rep(1),
ids = paste(parents, " - ", labels)) %>%
mutate(colors = case_when(
parents == "All" ~ "#e8f72f",
parents == "Creativity" ~ "#9d02d7",
parents == "Identity" ~ "#34dd26",
parents == "Knowledge" ~ "#0000ff",
parents == "Leadership" ~ "#ffb14e"
)) %>%
select(labels, values, parents, ids, img, country, role, description, colors)
# bind dataframes
women2 <- rbind(df1, df2)
# break up long descriptive label for sunburst chart hover text
women2$description2 <- stringr::str_wrap(women2$description, width = 100)
fig <- plot_ly(
women2,
ids = ~ids,
labels = ~labels,
parents = ~parents,
type = 'sunburst',
insidetextorientation='radial',
hovertemplate = glue::glue(
"<b>{women2$labels}</b><br>",
"<b>Country: {women2$country}</b><br>",
"<b>Role: {women2$role}</b><br>",
"{women2$description2}",
"<extra></extra>"),
marker = list(colors = ~colors)
) %>%
layout(title = list(text = "<b>The BBC's 100 women of 2020</b>")) %>%
layout(paper_bgcolor='rgba(60,174,163,1)')
fig
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidytuesdayR)
library(janitor)
theme_set(theme_light())
# Chunk 2: Load
tt <- tt_load("2021-01-19")
# Chunk 3: Readme
tt
# Chunk 4: Glimpse
tt %>%
map(glimpse)
# Chunk 5: Wrangle
gender <- tt$gender %>%
clean_names() %>%
filter(county != "Total") %>%
select(-intersex) %>%
mutate(county = ifelse(county == "Nairobi City", "Nairobi", county),
sub_county = str_to_upper(str_replace_all(county, " ", "")),
pct_male = male/total,
pct_female = female/total)
crops <- tt$crops %>%
clean_names() %>%
mutate(sub_county = str_replace_all(sub_county, " ", ""))
households <- tt$households %>%
clean_names() %>%
mutate(county = str_trim(county),
county = ifelse(county == "NairobiCity", "Nairobi", county),
sub_county = str_to_upper(county))
census <- gender %>%
inner_join(crops, by = "sub_county") %>%
inner_join(households %>% select(-county), by = "sub_county")
# Chunk 6: Visualize
gender %>%
top_n(10, wt = -pct_female) %>%
mutate(county = fct_reorder(county, pct_female)) %>%
ggplot(aes(pct_female, county, fill = county)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = scales::percent_format()) +
labs(x = "% female",
y = "",
title = "Kenya Census",
subtitle = "10 counties with lowest percentage of females",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
gender %>%
top_n(10, wt = pct_female) %>%
mutate(county = fct_reorder(county, pct_female)) %>%
ggplot(aes(pct_female, county, fill = county)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = scales::percent_format()) +
labs(x = "% female",
y = "",
title = "Kenya Census",
subtitle = "10 counties with highest percentage of females",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
crops %>%
filter(sub_county == "KENYA") %>%
pivot_longer(cols = farming:khat_miraa, names_to = "crop", values_to = "pop_growing") %>%
filter(crop != "farming") %>%
mutate(crop = str_to_title(str_replace(crop, "_", " ")),
crop = fct_reorder(crop, pop_growing)) %>%
ggplot(aes(pop_growing, crop, fill = crop)) +
geom_col(show.legend = FALSE) +
labs(x = "Population growing",
y = "",
title = "Kenya Crops",
subtitle = "More of the population grows avocados than any other crop",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
# Chunk 7
# This will save your most recent plot
ggsave(
filename = "My TidyTuesday Plot.png",
device = "png")
View(census)
census %>%
top_n(10, wt = -pct_female) %>%
mutate(county = fct_reorder(county, pct_female)) %>%
ggplot(aes(pct_female, county, fill = county)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = scales::percent_format()) +
labs(x = "% female",
y = "",
title = "Kenya Census",
subtitle = "10 counties with lowest percentage of females",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
census %>%
top_n(10, wt = pct_female) %>%
mutate(county = fct_reorder(county, pct_female)) %>%
ggplot(aes(pct_female, county, fill = county)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = scales::percent_format()) +
labs(x = "% female",
y = "",
title = "Kenya Census",
subtitle = "10 counties with highest percentage of females",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
crops %>%
filter(sub_county == "KENYA") %>%
pivot_longer(cols = farming:khat_miraa, names_to = "crop", values_to = "pop_growing") %>%
filter(crop != "farming") %>%
mutate(crop = str_to_title(str_replace(crop, "_", " ")),
crop = fct_reorder(crop, pop_growing)) %>%
ggplot(aes(pop_growing, crop, fill = crop)) +
geom_col(show.legend = FALSE) +
labs(x = "Population growing",
y = "",
title = "Kenya Crops",
subtitle = "More of the population grows avocados than any other crop",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
View(census)
census %>%
top_n(10, wt = average_household_size) %>%
mutate(county = fct_reorder(county, average_household_size)) %>%
ggplot(aes(aaverage_household_size, county, fill = county)) +
geom_col(show.legend = FALSE)
census %>%
top_n(10, wt = average_household_size) %>%
mutate(county = fct_reorder(county, average_household_size)) %>%
ggplot(aes(average_household_size, county, fill = county)) +
geom_col(show.legend = FALSE)
census %>%
top_n(10, wt = average_household_size) %>%
mutate(county = fct_reorder(county, average_household_size)) %>%
ggplot(aes(average_household_size, county, fill = county)) +
geom_col(show.legend = FALSE) +
labs(x = "Average household size",
y = "",
title = "Kenya Census",
subtitle = "10 counties with the largest average household size",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
crops %>%
filter(sub_county == "KENYA") %>%
pivot_longer(cols = farming:khat_miraa, names_to = "crop", values_to = "pop_growing") %>%
filter(crop != "farming") %>%
mutate(crop = str_to_title(str_replace(crop, "_", " ")),
crop = fct_reorder(crop, pop_growing)) %>%
ggplot(aes(pop_growing, crop, fill = crop)) +
geom_col(show.legend = FALSE) +
labs(x = "Population growing",
y = "",
title = "Kenya Crops",
subtitle = "More of the population grows avocados than any other crop",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
library(scales)
census %>%
top_n(10, wt = pct_female) %>%
mutate(county = fct_reorder(county, pct_female)) %>%
ggplot(aes(pct_female, county, fill = county)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = percent_format()) +
labs(x = "% female",
y = "",
title = "Kenya Census",
subtitle = "10 counties with highest percentage of females",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
labs(x = "Population growing",
y = "",
title = "Kenya Crops",
subtitle = "More of the population grows avocados than any other crop",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
crops %>%
filter(sub_county == "KENYA") %>%
pivot_longer(cols = farming:khat_miraa, names_to = "crop", values_to = "pop_growing") %>%
filter(crop != "farming") %>%
mutate(crop = str_to_title(str_replace(crop, "_", " ")),
crop = fct_reorder(crop, pop_growing)) %>%
ggplot(aes(pop_growing, crop, fill = crop)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = comma_format()) +
labs(x = "Population growing",
y = "",
title = "Kenya Crops",
subtitle = "More of the population grows avocados than any other crop",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
crops %>%
filter(sub_county == "KENYA") %>%
pivot_longer(cols = farming:khat_miraa, names_to = "crop", values_to = "pop_growing") %>%
filter(crop != "farming") %>%
mutate(crop = str_to_title(str_replace(crop, "_", " ")),
crop = fct_reorder(crop, pop_growing)) %>%
ggplot(aes(pop_growing, crop, fill = crop)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = comma_format()) +
labs(x = "# of people growing the crop",
y = "",
title = "Kenya Crops",
subtitle = "More of the population grows avocados than any other crop",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
# This will save your most recent plot
ggsave(
filename = "gdatascience1_202104.png",
device = "png")
setwd("~/GitHub/tidytuesday")
# This will save your most recent plot
ggsave(
filename = "gdatascience1_202104.png",
device = "png")
# This will save your most recent plot
ggsave(
filename = "gdatascience1_202104.png",
device = "png",
width = 5)
crops %>%
filter(sub_county == "KENYA") %>%
pivot_longer(cols = farming:khat_miraa, names_to = "crop", values_to = "pop_growing") %>%
filter(crop != "farming") %>%
mutate(crop = str_to_title(str_replace(crop, "_", " ")),
crop = fct_reorder(crop, pop_growing)) %>%
ggplot(aes(pop_growing, crop, fill = crop)) +
geom_col(show.legend = FALSE) +
scale_x_continuous(labels = comma_format()) +
labs(x = "# of people growing the crop",
y = "",
title = "Kenya Crops",
subtitle = "Avocados and mangos are grown by the most people",
caption = "Source: rKenyaCensus  |  Analysis: Tony Galvan (@GDataScience1)")
# This will save your most recent plot
ggsave(
filename = "gdatascience1_202104.png",
device = "png",
width = 5)
